<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Crear Cuenta - RentAll</title>
  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
  <!-- FontAwesome para iconos -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <style>
    :root {
      --primary-color: #2C3E50;
      --accent-color: #3498DB;
      --text-color: #2C3E50;
      --background-color: #ECF0F1;
    }

    body {
      min-height: 100vh;
      background: linear-gradient(135deg, rgba(44, 62, 80, 0.9), rgba(52, 152, 219, 0.9)),
                  url('https://images.unsplash.com/photo-1554995207-c18c203602cb?ixlib=rb-4.0.3');
      background-size: cover;
      background-position: center;
      font-family: 'Segoe UI', sans-serif;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px 0;
    }

    .register-container {
      width: 100%;
      max-width: 800px;
      background: rgba(255, 255, 255, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 20px;
      box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
      padding: 40px;
      margin: 20px;
    }

    .register-header {
      text-align: center;
      margin-bottom: 30px;
    }

    .register-header img {
      width: 120px;
      margin-bottom: 20px;
    }

    .steps-indicator {
      display: flex;
      justify-content: center;
      margin-bottom: 30px;
    }

    .step-dot {
      width: 35px;
      height: 35px;
      border-radius: 50%;
      background-color: #e9ecef;
      margin: 0 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #6c757d;
      font-weight: 600;
      position: relative;
      transition: all 0.3s ease;
    }

    .step-dot.active {
      background-color: var(--accent-color);
      color: white;
    }

    .step-dot.completed {
      background-color: #2ecc71;
      color: white;
    }

    .step-dot::after {
      content: '';
      position: absolute;
      width: 100%;
      height: 3px;
      background-color: #e9ecef;
      right: -100%;
      top: 50%;
      transform: translateY(-50%);
    }

    .step-dot:last-child::after {
      display: none;
    }

    .form-control {
      background-color: #f8f9fa;
      border: 2px solid #e9ecef;
      border-radius: 10px;
      padding: 12px 15px;
      font-size: 16px;
      transition: all 0.3s ease;
    }

    .form-control:focus {
      border-color: var(--accent-color);
      box-shadow: 0 0 0 0.2rem rgba(52, 152, 219, 0.25);
      background-color: #ffffff;
    }

    .btn {
      padding: 12px 20px;
      border-radius: 10px;
      font-weight: 600;
      transition: all 0.3s ease;
    }

    .btn-next {
      background: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      color: white;
      border: none;
    }

    .btn-next:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(52, 152, 219, 0.4);
    }

    .btn-prev {
      background-color: #6c757d;
      color: white;
      border: none;
    }

    .social-buttons {
      display: flex;
      gap: 15px;
      margin-top: 20px;
    }

    .btn-social {
      flex: 1;
      padding: 12px;
      border-radius: 10px;
      border: 2px solid #e9ecef;
      background-color: #ffffff;
      color: #495057;
      font-weight: 500;
      transition: all 0.3s ease;
    }

    .btn-social:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
    }

    .btn-google { color: #DB4437; }
    .btn-facebook { color: #4267B2; }

    #avatarPreview {
      width: 150px;
      height: 150px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 20px;
      border: 3px solid var(--accent-color);
      box-shadow: 0 5px 15px rgba(0,0,0,0.1);
      transition: all 0.3s ease;
    }

    .upload-btn-wrapper {
      position: relative;
      overflow: hidden;
      display: inline-block;
    }

    .upload-btn-wrapper input[type=file] {
      font-size: 100px;
      position: absolute;
      left: 0;
      top: 0;
      opacity: 0;
      cursor: pointer;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-20px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .step {
      display: none;
      animation: fadeIn 0.5s ease-out;
    }

    .step.active {
      display: block;
    }

    .form-floating {
      margin-bottom: 20px;
    }

    .form-floating > .form-control {
      padding-top: 1.625rem;
      padding-bottom: 0.625rem;
    }

    .form-floating > label {
      padding: 1rem 0.75rem;
    }
  </style>
</head>
<body>
  <div class="register-container">
    <div class="register-header">
      <img src="https://i.imgur.com/YEK3YQp.png" alt="RentAll Logo">
      <h2>Crear tu cuenta</h2>
      <p class="text-muted">Únete a nuestra comunidad</p>
    </div>

    <div class="steps-indicator">
      <div class="step-dot active">1</div>
      <div class="step-dot">2</div>
      <div class="step-dot">3</div>
    </div>

    <form id="registerForm" method="POST" action="{{ url_for('auth.register') }}" enctype="multipart/form-data">
      <!-- Paso 1: Datos Básicos -->
      <div id="step1" class="step active">
        <div class="social-buttons mb-4">
          <button type="button" class="btn-social btn-google">
            <i class="fab fa-google me-2"></i>Registrarse con Google
          </button>
          <button type="button" class="btn-social btn-facebook">
            <i class="fab fa-facebook-f me-2"></i>Registrarse con Facebook
          </button>
        </div>

        <div class="text-center mb-4">
          <span class="text-muted">O regístrate con tu correo</span>
        </div>

        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="nombre" name="nombre" placeholder="Nombre" maxlength="10" required>
          <label for="nombre"><i class="fas fa-user me-2"></i>Nombre</label>
        </div>

        <div class="form-floating mb-3">
          <input type="email" class="form-control" id="correo" name="correo" placeholder="Correo" maxlength="10" required>
          <label for="correo"><i class="fas fa-envelope me-2"></i>Correo electrónico</label>
        </div>

        <div class="form-floating mb-3">
          <input type="password" class="form-control" id="contrasenia" name="contrasenia" placeholder="Contraseña" maxlength="15" required>
          <label for="contrasenia"><i class="fas fa-lock me-2"></i>Contraseña</label>
        </div>

        <div class="form-floating mb-4">
          <input type="password" class="form-control" id="confirmContrasenia" name="confirmContrasenia" placeholder="Confirmar Contraseña" maxlength="15" required>
          <label for="confirmContrasenia"><i class="fas fa-lock me-2"></i>Confirmar Contraseña</label>
        </div>

        <button type="button" class="btn btn-next w-100" onclick="nextStep()">
          Siguiente <i class="fas fa-arrow-right ms-2"></i>
        </button>
      </div>

      <!-- Paso 2: Datos Personales -->
      <div id="step2" class="step">
        <div class="form-floating mb-3">
          <input type="text" class="form-control" id="docIdentidad" name="docIdentidad" placeholder="Documento de Identidad" maxlength="10" required>
          <label for="docIdentidad"><i class="fas fa-id-card me-2"></i>Documento de Identidad</label>
        </div>

        <div class="form-floating mb-3">
          <input type="tel" class="form-control" id="telefono" name="telefono" placeholder="Teléfono" maxlength="11" required>
          <label for="telefono"><i class="fas fa-phone me-2"></i>Teléfono</label>
        </div>

        <div class="form-floating mb-4">
          <input type="text" class="form-control" id="direccion" name="direccion" placeholder="Dirección" maxlength="30" required>
          <label for="direccion"><i class="fas fa-home me-2"></i>Dirección</label>
        </div>

        <div class="d-flex gap-3">
          <button type="button" class="btn btn-prev w-50" onclick="prevStep()">
            <i class="fas fa-arrow-left me-2"></i> Anterior
          </button>
          <button type="button" class="btn btn-next w-50" onclick="nextStep()">
            Siguiente <i class="fas fa-arrow-right ms-2"></i>
          </button>
        </div>
      </div>

      <!-- Paso 3: Imagen y Tipo de Usuario -->
      <div id="step3" class="step">
        <div class="text-center mb-4">
          <img src="https://via.placeholder.com/150" alt="Vista previa" id="avatarPreview">
          <div class="upload-btn-wrapper">
            <button class="btn btn-outline-primary">
              <i class="fas fa-camera me-2"></i>Subir foto de perfil
            </button>
            <input type="file" id="imagen" name="imagen" accept="image/*" required>
          </div>
        </div>

        <div class="form-floating mb-4">
          <select class="form-control" id="tipoUsuario" name="tipoUsuario" required>
            <option value="">Seleccione una opción</option>
            <option value="1">Cliente</option>
            <option value="2">Propietario</option>
          </select>
          <label for="tipoUsuario"><i class="fas fa-users me-2"></i>Tipo de Usuario</label>
        </div>

        <div class="d-flex gap-3">
          <button type="button" class="btn btn-prev w-50" onclick="prevStep()">
            <i class="fas fa-arrow-left me-2"></i> Anterior
          </button>
          <button type="submit" class="btn btn-next w-50">
            <i class="fas fa-check me-2"></i> Crear Cuenta
          </button>
        </div>
      </div>
    </form>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    // Variables para manejar los pasos
    const steps = document.querySelectorAll('.step');
    let currentStep = 0;

    // Función para mostrar el paso actual
    function showStep(index) {
        steps.forEach((step, i) => {
            if (i === index) {
                step.classList.add('active');
            } else {
                step.classList.remove('active');
            }
        });
        currentStep = index;
    }

    // Función para validar el formulario
    function validateForm(step) {
        const inputs = steps[step].querySelectorAll('input, select');
        let isValid = true;
        
        inputs.forEach(input => {
            if (input.hasAttribute('required') && !input.value) {
                isValid = false;
                input.classList.add('is-invalid');
            } else {
                input.classList.remove('is-invalid');
            }
        });

        return isValid;
    }

    // Función para pasar al siguiente paso
    function nextStep() {
        if (!validateForm(currentStep)) {
            alert('Por favor, complete todos los campos requeridos.');
            return;
        }

        if (currentStep === 0) {
            // Validación específica para el paso 1
            const contrasenia = document.getElementById('contrasenia').value;
            const confirmContrasenia = document.getElementById('confirmContrasenia').value;
            
            if (contrasenia !== confirmContrasenia) {
                alert('Las contraseñas no coinciden');
                return;
            }
        }

        if (currentStep < steps.length - 1) {
            showStep(currentStep + 1);
        }
    }

    // Función para retroceder al paso anterior
    function prevStep() {
        if (currentStep > 0) {
            showStep(currentStep - 1);
        }
    }

    // Previsualizar la imagen de perfil
    document.getElementById('imagen').addEventListener('change', function(e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(event) {
                document.getElementById('avatarPreview').src = event.target.result;
            }
            reader.readAsDataURL(file);
        }
    });

    // Manejo del envío del formulario
    document.getElementById('registerForm').addEventListener('submit', function(e) {
        e.preventDefault();

        if (!validateForm(currentStep)) {
            alert('Por favor, complete todos los campos requeridos.');
            return;
        }

        // Crear FormData para enviar los datos incluyendo la imagen
        const formData = new FormData(this);

        // Enviar el formulario
        fetch(this.action, {
            method: 'POST',
            body: formData
        })
        .then(response => {
            if (response.redirected) {
                window.location.href = response.url;
            } else {
                return response.text();
            }
        })
        .then(data => {
            if (data) {
                try {
                    const result = JSON.parse(data);
                    if (result.error) {
                        alert(result.error);
                    } else if (result.success) {
                        window.location.href = result.redirect;
                    }
                } catch (e) {
                    // Si no es JSON, probablemente sea HTML
                    document.open();
                    document.write(data);
                    document.close();
                }
            }
        })
        .catch(error => {
            console.error('Error:', error);
            alert('Ocurrió un error al procesar el registro');
        });
    });
  </script>
</body>
</html>
