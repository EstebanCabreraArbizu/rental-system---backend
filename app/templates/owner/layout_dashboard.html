<!DOCTYPE html>
<html lang="es">

<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>Dashboard Propietario - RentAll</title>
	<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
	<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
	<!-- Chart.js -->
	<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
	<style>
		:root {
			--primary-color: #2C3E50;
			--accent-color: #3498DB;
			--success-color: #2ECC71;
			--warning-color: #F1C40F;
			--danger-color: #E74C3C;
		}

		.navbar-custom {
			background-color: var(--primary-color);
		}

		.sidebar {
			background-color: var(--primary-color);
			min-height: calc(100vh - 56px);
			color: white;
		}

		.sidebar .nav-link {
			color: rgba(255, 255, 255, .8);
			padding: 1rem;
			transition: all 0.3s;
		}

		.sidebar .nav-link:hover {
			background-color: var(--accent-color);
			color: white;
		}

		.stats-card {
			background: white;
			border-radius: 15px;
			padding: 1.5rem;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			transition: transform 0.3s ease;
		}

		.stats-card:hover {
			transform: translateY(-5px);
		}

		.chart-container {
			background: white;
			border-radius: 15px;
			padding: 1.5rem;
			box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			margin-bottom: 1.5rem;
		}
	</style>
</head>

<body>
	{% block body %}
	{% endblock %}
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
	<script>
		// Datos para los gráficos
		const tipoPublicacionData = {
			labels: ['Vivienda', 'Vehículo'],
			datasets: [{
				data: [
					{{ publicaciones| selectattr('tipo_publicacion', 'equalto', 'Vivienda') | list | length }},
			{{ publicaciones| selectattr('tipo_publicacion', 'equalto', 'Vehículo') | list | length }}
                ],
		backgroundColor: ['#3498DB', '#2ECC71']
            }]
        };

		const interesadosPorMes = {
			labels: ['Ene', 'Feb', 'Mar', 'Abr', 'May', 'Jun'],
			datasets: [{
				label: 'Interesados',
				data: [12, 19, 3, 5, 2, 3],
				borderColor: '#3498DB',
				tension: 0.1
			}]
		};

		// Configurar gráficos
		new Chart(document.getElementById('tipoPublicacionChart'), {
			type: 'doughnut',
			data: tipoPublicacionData,
			options: {
				responsive: true,
				plugins: {
					legend: {
						position: 'bottom'
					}
				}
			}
		});

		new Chart(document.getElementById('interesadosChart'), {
			type: 'line',
			data: interesadosPorMes,
			options: {
				responsive: true,
				scales: {
					y: {
						beginAtZero: true
					}
				}
			}
		});


		// Función para cargar las publicaciones
		function cargarPublicaciones() {
			fetch('/owner/publicaciones')
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						actualizarTablaPublicaciones(data.publicaciones);
						actualizarGraficos(data.publicaciones);
					}
				});
		}

		// Función para actualizar estado
		function actualizarEstado(id, estado) {
			fetch(`/owner/publicacion/${id}/estado`, {
				method: 'PUT',
				headers: {
					'Content-Type': 'application/json',
				},
				body: JSON.stringify({ estado: estado })
			})
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						cargarPublicaciones();
					}
				});
		}

		// Función para eliminar publicación
		function eliminarPublicacion(id) {
			if (confirm('¿Estás seguro de que deseas eliminar esta publicación?')) {
				fetch(`/owner/delete/${id}`, {
					method: 'DELETE'
				})
					.then(response => response.json())
					.then(data => {
						if (data.success) {
							cargarPublicaciones();
						}
					});
			}
		}

		// Función para cargar estadísticas de interesados
		function cargarEstadisticasInteresados() {
			fetch('/owner/estadisticas/interesados')
				.then(response => response.json())
				.then(data => {
					if (data.success) {
						actualizarGraficoInteresados(data.datos);
					}
				});
		}

		// Inicializar la página
		document.addEventListener('DOMContentLoaded', function () {
			cargarPublicaciones();
			cargarEstadisticasInteresados();
		});

	</script>
</body>

</html>